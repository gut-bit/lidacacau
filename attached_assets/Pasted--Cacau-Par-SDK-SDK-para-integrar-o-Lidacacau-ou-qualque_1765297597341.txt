# Cacau Pará SDK

SDK para integrar o Lidacacau (ou qualquer outro app) com a plataforma Cacau Pará.

## Instalação

Copie o arquivo `cacau-para-sdk.ts` para o seu projeto Lidacacau.

## Uso Básico

```typescript
import { CacauParaClient } from './cacau-para-sdk';

// Inicializar o cliente
const client = new CacauParaClient('https://seu-cacaupara-url.replit.app');

// Com autenticação (opcional)
const clientAuth = new CacauParaClient({
  baseUrl: 'https://seu-cacaupara-url.replit.app',
  authToken: 'seu-token-aqui',
  timeout: 15000 // 15 segundos
});
```

## Funções Disponíveis

### Submeter Preço

```typescript
const price = await client.submitPrice({
  buyerName: 'Cargill',
  city: 'Medicilândia',
  pricePerKg: '19.50',
  // Opcionais:
  userId: 'uuid-do-usuario',
  region: 'Transamazônica',
  conditions: 'Cacau seco, tipo 1',
});

console.log('Preço publicado:', price.id);
```

### Listar Preços

```typescript
const prices = await client.listPrices();

prices.forEach(p => {
  console.log(`${p.buyerName} em ${p.city}: R$ ${p.pricePerKg}/kg`);
});
```

### Encontrar Melhor Preço

```typescript
const prices = await client.listPrices();
const best = client.findBestPrice(prices);

if (best) {
  console.log(`Melhor preço: R$ ${best.pricePerKg}/kg em ${best.city}`);
}
```

### Filtrar por Cidade

```typescript
const prices = await client.listPrices();
const medicilandia = client.filterByCity(prices, 'Medicilândia');
```

### Filtrar por Comprador

```typescript
const prices = await client.listPrices();
const cargill = client.filterByBuyer(prices, 'Cargill');
```

### Notas da Comunidade

```typescript
// Buscar notas de um preço
const notes = await client.getPriceNotes('price-uuid');

// Adicionar nota
const note = await client.addPriceNote('price-uuid', {
  userId: 'user-uuid',
  noteType: 'context', // 'correction' | 'context' | 'concern'
  content: 'Preço confirmado por 3 produtores da região'
});
```

### Compartilhar via WhatsApp

```typescript
const price = await client.submitPrice({...});

// Gerar link de compartilhamento
const shareLink = client.generateWhatsAppShareLink(price);
window.open(shareLink, '_blank');

// Com número específico
const linkDireto = client.generateWhatsAppShareLink(price, '5591999999999');
```

## Cidades Suportadas

```typescript
import { SUPPORTED_CITIES } from './cacau-para-sdk';

// ['Medicilândia', 'Uruará', 'Brasil Novo', 'Altamira', 
//  'Pacajá', 'Anapu', 'Vitória do Xingu', 'Senador José Porfírio']
```

## Tratamento de Erros

```typescript
import { CacauParaClient, CacauParaError } from './cacau-para-sdk';

try {
  const price = await client.submitPrice({...});
} catch (error) {
  if (error instanceof CacauParaError) {
    console.error(`Erro ${error.status}: ${error.message}`);
    console.error('Detalhes:', error.details);
  }
}
```

## Tipos TypeScript

O SDK exporta todos os tipos necessários:

```typescript
import type { 
  PriceSubmission, 
  CommunityNote,
  SubmitPriceInput,
  AddNoteInput,
  SupportedCity 
} from './cacau-para-sdk';
```

## Exemplo Completo: Integração no Lidacacau

```typescript
import { CacauParaClient, CacauParaError, SUPPORTED_CITIES } from './cacau-para-sdk';

const cacauPara = new CacauParaClient('https://cacaupara.replit.app');

// Função para enviar preço do Lidacacau para Cacau Pará
async function sincronizarPreco(buyer: string, city: string, price: number) {
  try {
    const submission = await cacauPara.submitPrice({
      buyerName: buyer,
      city: city,
      pricePerKg: price.toFixed(2),
    });
    
    console.log('Preço sincronizado com Cacau Pará:', submission.id);
    return submission;
  } catch (error) {
    if (error instanceof CacauParaError) {
      console.error('Falha ao sincronizar:', error.message);
    }
    throw error;
  }
}

// Função para buscar preços atualizados
async function buscarPrecosAtuais(cidade?: string) {
  const prices = await cacauPara.listPrices();
  
  if (cidade) {
    return cacauPara.filterByCity(prices, cidade);
  }
  
  return prices;
}

// Função para obter dashboard de preços
async function getDashboard() {
  const prices = await cacauPara.listPrices();
  const bestPrice = cacauPara.findBestPrice(prices);
  
  const byCity: Record<string, number> = {};
  prices.forEach(p => {
    const current = byCity[p.city] || 0;
    const priceVal = parseFloat(p.pricePerKg);
    if (priceVal > current) {
      byCity[p.city] = priceVal;
    }
  });
  
  return {
    totalPrices: prices.length,
    bestPrice,
    pricesByCity: byCity,
  };
}
```
